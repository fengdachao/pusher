# ğŸ‰ ç›‘æ§ç³»ç»Ÿæœ€ç»ˆéƒ¨ç½²æ€»ç»“

## âœ… æˆåŠŸéƒ¨ç½²çš„ç›‘æ§ç»„ä»¶

### ğŸš€ **æ ¸å¿ƒæœåŠ¡çŠ¶æ€**

| æœåŠ¡ | çŠ¶æ€ | ç«¯å£ | åŠŸèƒ½ |
|------|------|------|------|
| **PostgreSQL** | âœ… è¿è¡Œä¸­ | 5432 | ä¸»æ•°æ®åº“ |
| **Redis** | âœ… è¿è¡Œä¸­ | 6379 | ç¼“å­˜æœåŠ¡ |
| **OpenSearch** | âœ… è¿è¡Œä¸­ | 9200 | æœç´¢å¼•æ“ |
| **Prometheus** | âœ… è¿è¡Œä¸­ | 9090 | æŒ‡æ ‡é‡‡é›† |
| **Redis Commander** | âœ… è¿è¡Œä¸­ | 8081 | Redis ç®¡ç† |

### ğŸ“Š **å·²å®ç°çš„ç›‘æ§åŠŸèƒ½**

#### 1. **å¥åº·æ£€æŸ¥ç³»ç»Ÿ** âœ…
- **æ¨¡å—**: `@nestjs/terminus`
- **ç«¯ç‚¹**: `/api/v1/health`
- **åŠŸèƒ½**: æ•°æ®åº“ã€å†…å­˜ã€ç£ç›˜çŠ¶æ€æ£€æŸ¥
- **çŠ¶æ€**: å·²é›†æˆåˆ° NestJS åº”ç”¨

#### 2. **Prometheus æŒ‡æ ‡é‡‡é›†** âœ…
- **æ¨¡å—**: `prom-client`
- **ç«¯ç‚¹**: `/api/v1/metrics`
- **åŠŸèƒ½**: ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡å¯¼å‡º
- **çŠ¶æ€**: Prometheus æœåŠ¡è¿è¡Œä¸­

#### 3. **ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ** âœ…
- **æ¨¡å—**: `winston`
- **åŠŸèƒ½**: é”™è¯¯æ—¥å¿—ã€ç»¼åˆæ—¥å¿—ã€æ§åˆ¶å°è¾“å‡º
- **ä½ç½®**: `backend/logs/`
- **çŠ¶æ€**: å·²é…ç½®å®Œæˆ

#### 4. **ä¸šåŠ¡ç›‘æ§ API** âœ…
- **ç³»ç»Ÿç»Ÿè®¡**: `/api/v1/monitoring/stats`
- **æ•°æ®åº“ç»Ÿè®¡**: `/api/v1/monitoring/database-stats`
- **çˆ¬è™«ç»Ÿè®¡**: `/api/v1/monitoring/crawler-stats`
- **ç”¨æˆ·ç»Ÿè®¡**: `/api/v1/monitoring/user-stats`

#### 5. **Redis ç®¡ç†ç•Œé¢** âœ…
- **å·¥å…·**: Redis Commander
- **è®¿é—®**: http://localhost:8081
- **åŠŸèƒ½**: Redis æ•°æ®å¯è§†åŒ–ç®¡ç†

---

## ğŸ› ï¸ **æŠ€æœ¯æ¶æ„**

### **ç›‘æ§æ ˆç»„æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NestJS App    â”‚    â”‚   Prometheus    â”‚    â”‚    Grafana     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Health Check  â”‚â—„â”€â”€â”€â–ºâ”‚ â€¢ Metrics       â”‚â—„â”€â”€â”€â–ºâ”‚ â€¢ Dashboards   â”‚
â”‚ â€¢ Metrics API   â”‚    â”‚ â€¢ Collection    â”‚    â”‚ â€¢ Visualizationâ”‚
â”‚ â€¢ Logging       â”‚    â”‚ â€¢ Storage       â”‚    â”‚ â€¢ Alerts       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PostgreSQL    â”‚    â”‚     Redis      â”‚    â”‚  OpenSearch    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Data Storage  â”‚    â”‚ â€¢ Caching      â”‚    â”‚ â€¢ Search Engine â”‚
â”‚ â€¢ Health Check  â”‚    â”‚ â€¢ Sessions     â”‚    â”‚ â€¢ Full-text     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ç›‘æ§æ•°æ®æµ**
1. **åº”ç”¨æŒ‡æ ‡** â†’ NestJS Metrics Service â†’ Prometheus
2. **ç³»ç»Ÿå¥åº·** â†’ Terminus Health Check â†’ API ç«¯ç‚¹
3. **åº”ç”¨æ—¥å¿—** â†’ Winston Logger â†’ æ–‡ä»¶ç³»ç»Ÿ
4. **æ•°æ®åº“çŠ¶æ€** â†’ TypeORM Health Indicator â†’ å¥åº·æ£€æŸ¥

---

## ğŸ“ˆ **ç›‘æ§æŒ‡æ ‡ç±»å‹**

### **ç³»ç»ŸæŒ‡æ ‡**
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ (RSS, Heap)
- ç£ç›˜ä½¿ç”¨æƒ…å†µ
- ç½‘ç»œè¿æ¥æ•°

### **åº”ç”¨æŒ‡æ ‡**
- HTTP è¯·æ±‚è®¡æ•°
- HTTP å“åº”æ—¶é—´
- æ•°æ®åº“è¿æ¥æ•°
- æ´»è·ƒç”¨æˆ·æ•°

### **ä¸šåŠ¡æŒ‡æ ‡**
- æ–‡ç« å‘å¸ƒæ•°é‡
- ç”¨æˆ·æ³¨å†Œæ•°é‡
- çˆ¬è™«ä»»åŠ¡çŠ¶æ€
- è®¢é˜…æ•°é‡ç»Ÿè®¡

---

## ğŸ”§ **è®¿é—®åœ°å€æ±‡æ€»**

### **ä¸»è¦æœåŠ¡**
- **å‰ç«¯åº”ç”¨**: http://localhost:3000
- **åç«¯ API**: http://localhost:3001
- **API æ–‡æ¡£**: http://localhost:3001/api/docs

### **ç›‘æ§ç«¯ç‚¹**
- **å¥åº·æ£€æŸ¥**: http://localhost:3001/api/v1/health
- **ç³»ç»ŸæŒ‡æ ‡**: http://localhost:3001/api/v1/metrics
- **ç³»ç»Ÿç»Ÿè®¡**: http://localhost:3001/api/v1/monitoring/stats

### **ç®¡ç†å·¥å…·**
- **Prometheus**: http://localhost:9090
- **Redis ç®¡ç†**: http://localhost:8081
- **æ•°æ®åº“**: localhost:5432
- **æœç´¢å¼•æ“**: localhost:9200

---

## ğŸš€ **å¯åŠ¨å‘½ä»¤**

### **å®Œæ•´ç›‘æ§ç³»ç»Ÿ**
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåŒ…æ‹¬ Prometheus + Grafanaï¼‰
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### **åŸºç¡€æœåŠ¡**
```bash
# å¯åŠ¨åŸºç¡€æœåŠ¡ï¼ˆæ¨èï¼‰
docker-compose -f docker-compose-simple.yml up -d

# å¯åŠ¨åº”ç”¨æœåŠ¡
docker-compose -f docker-compose-simple.yml up backend frontend -d
```

---

## ğŸ“ **æ—¥å¿—æ–‡ä»¶ä½ç½®**

- **åº”ç”¨é”™è¯¯æ—¥å¿—**: `backend/logs/error.log`
- **åº”ç”¨ç»¼åˆæ—¥å¿—**: `backend/logs/combined.log`
- **Docker æœåŠ¡æ—¥å¿—**: `docker-compose logs [service_name]`

---

## ğŸ¯ **ç›‘æ§æœ€ä½³å®è·µ**

### **1. å¥åº·æ£€æŸ¥**
```bash
# æ£€æŸ¥ç³»ç»Ÿå¥åº·çŠ¶æ€
curl http://localhost:3001/api/v1/health

# æ£€æŸ¥ç‰¹å®šç»„ä»¶
curl http://localhost:3001/api/v1/health/database
curl http://localhost:3001/api/v1/health/memory
```

### **2. æŒ‡æ ‡ç›‘æ§**
```bash
# æŸ¥çœ‹ Prometheus æŒ‡æ ‡
curl http://localhost:3001/api/v1/metrics

# è®¿é—® Prometheus ç•Œé¢
open http://localhost:9090
```

### **3. æ—¥å¿—åˆ†æ**
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f backend/logs/combined.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f backend/logs/error.log
```

---

## ğŸ”’ **å®‰å…¨å»ºè®®**

### **ç”Ÿäº§ç¯å¢ƒé…ç½®**
1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - æ•°æ®åº“å¯†ç 
   - Redis å¯†ç 
   - JWT å¯†é’¥

2. **ç½‘ç»œå®‰å…¨**
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - ä½¿ç”¨ HTTPS
   - é™åˆ¶ç›‘æ§ç«¯ç‚¹è®¿é—®

3. **æ—¥å¿—å®‰å…¨**
   - é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯
   - å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶
   - é…ç½®æ—¥å¿—è½®è½¬

---

## ğŸ† **éƒ¨ç½²æˆåŠŸæ€»ç»“**

### âœ… **å·²å®Œæˆçš„åŠŸèƒ½**
- [x] å¥åº·æ£€æŸ¥ç³»ç»Ÿ
- [x] Prometheus æŒ‡æ ‡é‡‡é›†
- [x] Winston æ—¥å¿—ç³»ç»Ÿ
- [x] ä¸šåŠ¡ç›‘æ§ API
- [x] Redis ç®¡ç†ç•Œé¢
- [x] æ•°æ®åº“è¿æ¥ç›‘æ§
- [x] ç³»ç»Ÿæ€§èƒ½ç›‘æ§

### ğŸ¯ **ç›‘æ§èƒ½åŠ›**
- **å®æ—¶ç›‘æ§**: ç³»ç»ŸçŠ¶æ€å®æ—¶æ›´æ–°
- **æ€§èƒ½ç›‘æ§**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ
- **ä¸šåŠ¡ç›‘æ§**: ç”¨æˆ·ã€æ–‡ç« ã€è®¢é˜…ç»Ÿè®¡
- **æ—¥å¿—ç›‘æ§**: ç»“æ„åŒ–æ—¥å¿—è®°å½•å’Œåˆ†æ
- **å‘Šè­¦èƒ½åŠ›**: å¯é…ç½®é˜ˆå€¼å‘Šè­¦

### ğŸ’° **æˆæœ¬ä¼˜åŠ¿**
- **å®Œå…¨å…è´¹**: æ‰€æœ‰å·¥å…·éƒ½æ˜¯å¼€æºå…è´¹
- **æœ¬åœ°éƒ¨ç½²**: æ— éœ€å¤–éƒ¨æœåŠ¡ä¾èµ–
- **èµ„æºé«˜æ•ˆ**: ä½èµ„æºæ¶ˆè€—
- **æ˜“äºç»´æŠ¤**: Docker å®¹å™¨åŒ–ç®¡ç†

---

## ğŸ‰ **æ­å–œï¼ç›‘æ§ç³»ç»Ÿéƒ¨ç½²å®Œæˆï¼**

æ‚¨çš„æ–°é—»è®¢é˜…ç³»ç»Ÿç°åœ¨æ‹¥æœ‰äº†å®Œæ•´çš„ç›‘æ§èƒ½åŠ›ï¼š

- âœ… **ç³»ç»Ÿå¥åº·ç›‘æ§**
- âœ… **æ€§èƒ½æŒ‡æ ‡é‡‡é›†**
- âœ… **ä¸šåŠ¡æ•°æ®ç»Ÿè®¡**
- âœ… **ç»“æ„åŒ–æ—¥å¿—è®°å½•**
- âœ… **å¯è§†åŒ–ç®¡ç†ç•Œé¢**

**ç›‘æ§ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ç›‘æ§æ‚¨çš„åº”ç”¨äº†ï¼** ğŸš€

---

## ğŸ“ **æŠ€æœ¯æ”¯æŒ**

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡çŠ¶æ€: `docker-compose ps`
2. æœåŠ¡æ—¥å¿—: `docker-compose logs [service_name]`
3. å¥åº·æ£€æŸ¥: `curl http://localhost:3001/api/v1/health`
4. ç½‘ç»œè¿æ¥: `curl http://localhost:9090`

**ğŸŠ ç›‘æ§ç³»ç»Ÿéƒ¨ç½²å®Œå…¨æˆåŠŸï¼**
